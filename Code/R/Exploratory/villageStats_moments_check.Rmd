---
title: "Intermediate outputs for sanity checks and 備忘録"
author: "Sakina Shibuya"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
##### From Hiro's code

#rm(list = ls())

# Load packages

packages <- c(
  "R.matlab",
  "tidyverse",
  "igraph",
  "pracma",
  "ggplot2",
  "plotly",
  "dqrng",
  "Matrix", 
  "summarytools"
)

not_installed <- !packages %in% installed.packages()
if (any(not_installed)) install.packages(packages[not_installed])
lapply(packages,require,character.only = TRUE)

# Global setting
user <- "Sakina"
if (user == "Hiro"){
  project_path <- "/Users/mizuhirosuzuki/Dropbox/MFdiffusion_replication/"
}
if (user == "Sakina"){
  project_path <- "/home/sakina/Github/MFdiffusion_replication"
}
```

## Betas (coefficients from logistic model)

![Betas from R](betas_logCoeffs_R.png) 

![Betas from Matlab](betas_logCoeffs_M.png)


## Check moments calculations

Those moments are:
* V1 $\rightarrow$ Fraction of nodes that have no taking neighbors but are takers themselves 
* V2 $\rightarrow$ Fraction of individuals that are infected in the neighborhood of infected leaders stats_1 
* V3 $\rightarrow$ Fraction of individuals that are infected in the neighborhood of non-infected leaders 
* V4 $\rightarrow$ Covariance of individuals taking with share of neighbors taking 
* V5 $\rightarrow$ Covariance of individuals taking with share of second neighbors taking

The D matrix stores the difference between simulated and empirical values of each of the above moments. 

### No Endosement Model

#### Model 1  (qN = qP)

Results from R:
```{r echo=FALSE}
# Load D matrix
load(file = file.path(project_path, 'Rdata/data_model_1_mom_1_trimesters.RData'))

# Calculate the average for each moment for each simulation
villmnD <- list()
for (i in seq(dim(D)[3])) {
  villmnD[[i]] <- apply(D[,,1], 2, mean)
}
noEnd.moments.df <- as.data.frame(do.call(rbind, villmnD))

# Descriptive stats table
descr(noEnd.moments.df, stats = "common", transpose = T, headings = F, style = "rmarkdown")
```

Results from Matlab:

![D from Matlab](D_model1_M.png)

Somehow these values are different. To dig a bit deeper, I sample one calibration, and compare the means between R and Matlab.

It seems that the values are slightly different. The following is the village average of all five moments from the 1st calibration. 
Is this difference come from that there is no seeds set in the Matlab code?

![D{1} from Model 1 from Matlab](D_c1r1_model1_R.png)


![D{1} from Model 1 from Matlab](D_c1r1_model1_M.png)

#### Model 3  (qN \ne qP)

Results from R:
Still running...

Results from Matlab: 

![D from Matlab](D_model3_M.png)

### Endorsement Model
Still running....

